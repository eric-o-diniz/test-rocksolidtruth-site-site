<head>
  <script type="module">import { injectIntoGlobalHook } from "/@react-refresh";
injectIntoGlobalHook(window);
window.$RefreshReg$ = () => {};
window.$RefreshSig$ = () => (type) => type;</script>
  <script type="module" src="/@vite/client"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock Solid Roofing | Special Offer</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Nunito:wght@300;500;700&family=Passion+One:wght@700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Inter:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Nunito', sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #f9f9f9, #e0e7ff);
            line-height: 1.3;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            animation: fadeIn 1s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pre-headline {
            font-family: 'Nunito', sans-serif;
            font-size: 22px;
            font-weight: 500;
            color: #000000;
            margin-bottom: 0px;
        }
        .headline {
            font-family: 'Montserrat', sans-serif;
            font-size: 80px;
            font-weight: 900;
            color: #000000;
            margin-bottom: 8px;
            line-height: 1;
            letter-spacing: -4.2px;
        }
        .sub-headline {
            font-family: 'Nunito', sans-serif;
            font-size: 22px;
            max-width: 720px;
            margin: 0 auto 30px;
            color: #000000;
            font-weight: 300;
            line-height: 1.3;
        }
        .highlight {
            font-weight: bold;
            background-color: #ff0000;
            color: #fff;
            padding: 1px 2px;
            border-radius: 4px;
        }
        .input-container {
            margin: 25px 0 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeSlideUp 1.5s ease-out 0.5s forwards;
            opacity: 0;
        }
        .zip-input {
            width: 315px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ff0000;
            border-radius: 5px;
            text-align: center;
            transition: border-color 0.3s ease;
        }
        .zip-input:focus {
            border-color: #4a6db3;
            outline: none;
        }
        .zip-input::-moz-placeholder {
            color: #888;
        }
        .zip-input::placeholder {
            color: #888;
        }
        .zip-btn {
            font-family: 'Passion One', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: white;
            letter-spacing: 1px;
            padding: 10px 30px;
            background: linear-gradient(to top, #ff6666, #ff3333);
            border: none;
            cursor: not-allowed;
            box-shadow: 0 4px 12px 2px rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            transition: background 0.3s ease, transform 0.2s ease;
            width: 315px;
            white-space: nowrap;
            margin-top: 10px;
        }
        .zip-btn.active {
            background: linear-gradient(to top, #ff3333, #ff0000);
            cursor: pointer;
        }
        .zip-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 14px rgba(255, 0, 0, 0.4);
        }
        .zip-error {
            margin-top: 10px;
            color: #FF6B6B;
            font-size: 16px;
            display: none;
            align-items: center;
            gap: 8px;
            width: 100%;
        }
        .zip-feedback {
            margin-top: 10px;
            font-size: 15px;
            font-weight: normal;
            color: #333;
            display: none;
            width: 100%;
        }
        footer {
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 -10px 30px rgba(255, 0, 0, 0.5);
            font-size: 16px;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .footer-info {
            margin: 10px 0;
        }
        .footer-quote {
            font-style: italic;
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        .privacy-btn {
            background: none;
            border: none;
            color: #ff0000;
            text-decoration: underline;
            cursor: pointer;
            font-size: 12px;
        }
        .privacy-btn:hover {
            color: #4a6db3;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .pre-headline {
                font-size: 16px;
            }
            .headline {
                font-size: 48px;
                letter-spacing: -2.8px;
            }
            .sub-headline {
                font-size: 18px;
                max-width: 90%;
            }
            .input-container {
                margin-bottom: 40px;
            }
            .zip-input, .zip-btn {
                width: 100%;
                max-width: 300px;
                font-size: 14px;
            }
            .zip-btn {
                font-size: 20px;
                padding: 8px 20px;
            }
        }
        @media (max-width: 480px) {
            .headline {
                font-size: 39px;
                letter-spacing: -2px;
            }
            .sub-headline {
                font-size: 17px;
                max-width: 98%;
            }
        }
    </style>


</head>
<body>
    <div class="container">
        <div class="pre-headline">Find Out If Your Roof Needs Attention</div>
        <h1 class="headline">Free Roof Check</h1>
        <p class="sub-headline">Enter your zip code to see if we service your area and get a personalized roofing assessment. <span class="highlight">Takes 30 seconds!</span></p>
        
        <div class="input-container">
            <input type="text" class="zip-input" id="zip-input" placeholder="Enter your 5-digit zip code" maxlength="5" pattern="\d{5}" oninput="validateZipCode()">
            <button type="button" class="zip-btn" id="zip-btn" onclick="checkZipCode()" disabled>CHECK MY ZIP CODE</button>
            <p class="zip-feedback" id="zip-feedback"></p>
            <p class="zip-error" id="zip-error">Please enter a valid 5-digit ZIP code</p>
        </div>
    </div>

    <footer>
        <div class="footer-info">
            <p>Rock Solid Roofing | South Miami, Florida | 7868652728 | © 2025</p>
        </div>
        <div class="footer-quote">
            <p>"Quality roofing you can trust."</p>
        </div>
        <button class="privacy-btn" onclick="window.location.href='#'">Privacy Policy</button>
    </footer>

    <script>
        function validateZipCode() {
            const zipInput = document.getElementById('zip-input');
            const zipBtn = document.getElementById('zip-btn');
            const zipFeedback = document.getElementById('zip-feedback');
            const zipError = document.getElementById('zip-error');
            const zipValue = zipInput.value.trim();
            
            zipError.style.display = 'none';
            if (/^\d{5}$/.test(zipValue)) {
                zipBtn.classList.add('active');
                zipBtn.disabled = false;
                zipFeedback.style.display = 'block';
                zipFeedback.textContent = `Your zipcode is: ${zipValue}`;
            } else {
                zipBtn.classList.remove('active');
                zipBtn.disabled = true;
                zipFeedback.style.display = 'none';
            }
        }

        function checkZipCode() {
            const zipInput = document.getElementById('zip-input');
            const zipError = document.getElementById('zip-error');
            const zipValue = zipInput.value.trim();
            const quizOverlay = document.getElementById('quiz-overlay');
            if (/^\d{5}$/.test(zipValue) && quizOverlay) {
                zipError.style.display = 'none';
                const zipCodeInput = document.getElementById('zip_code');
                if (zipCodeInput) zipCodeInput.value = zipValue;
                quizOverlay.style.display = 'block';
                quizOverlay.classList.add('active');
                showStep(1);
            } else {
                zipError.style.display = 'flex';
            }
        }
    </script>
    
    <!-- INJECT QUIZ HERE -->
<script type="module">import { injectIntoGlobalHook } from "/@react-refresh";
injectIntoGlobalHook(window);
window.$RefreshReg$ = () => {};
window.$RefreshSig$ = () => (type) => type;</script>
<script type="module" src="/@vite/client"></script>

<div class="quiz-overlay" id="quiz-overlay">
    <div class="quiz-container">
        <button class="close-btn" onclick="closeOverlay()">✕</button>
        <div class="quiz-form">
            <form id="_builder-form" method="POST">
                <!-- Step 1: Are you the homeowner? (Radio) -->
                <div class="form-builder--item active" data-step="1">
                    <div class="question-title">Are you the homeowner?</div>
                    <div class="radio-options">
                        <label class="radio-option" onclick="selectOption(this, 'homeowner', 'Yes', 2)">
                            <input type="radio" name="homeowner" value="Yes" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">Yes</span>
                        </label>
                        <label class="radio-option" onclick="selectOption(this, 'homeowner', 'No', 2)">
                            <input type="radio" name="homeowner" value="No" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">No</span>
                        </label>
                        <label class="radio-option" onclick="selectOption(this, 'homeowner', 'Other', 2)">
                            <input type="radio" name="homeowner" value="Other" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">Other</span>
                        </label>
                    </div>
                    <p class="error-note" style="display: none;">Please select an option</p>
                    <div class="button-group">
                        <button type="button" class="back-btn" style="visibility: hidden;">Back</button>
                        <button type="button" class="next-btn" onclick="nextStep(2)">Continue</button>
                    </div>
                </div>
                <!-- Step 2: How old is your roof? (Radio) -->
                <div class="form-builder--item" data-step="2">
                    <div class="question-title">How old is your roof?</div>
                    <div class="radio-options">
                        <label class="radio-option" onclick="selectOption(this, 'roof_age', 'Less than 10 years', 3)">
                            <input type="radio" name="roof_age" value="Less than 10 years" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">Less than 10 years</span>
                        </label>
                        <label class="radio-option" onclick="selectOption(this, 'roof_age', '10-20 years', 3)">
                            <input type="radio" name="roof_age" value="10-20 years" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">10-20 years</span>
                        </label>
                        <label class="radio-option" onclick="selectOption(this, 'roof_age', 'More than 20 years', 3)">
                            <input type="radio" name="roof_age" value="More than 20 years" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">More than 20 years</span>
                        </label>
                        <label class="radio-option" onclick="selectOption(this, 'roof_age', 'Not sure', 3)">
                            <input type="radio" name="roof_age" value="Not sure" required>
                            <span class="custom-radio"></span>
                            <span class="radio-option-text">Not sure</span>
                        </label>
                    </div>
                    <p class="error-note" style="display: none;">Please select an option</p>
                    <div class="button-group">
                        <button type="button" class="back-btn" onclick="prevStep(1)">Back</button>
                        <button type="button" class="next-btn" onclick="nextStep(3)">Continue</button>
                    </div>
                </div>
                <!-- Step 3: What's the reason for inspection or service? (Checkboxes) -->
                <div class="form-builder--item" data-step="3">
                    <div class="question-title">What's the reason for inspection or service?</div>
                    <div class="checkbox-options">
                        <label class="checkbox-option" onclick="toggleCheckbox(this, 'reason', 'Leaks')">
                            <input type="checkbox" name="reason[]" value="Leaks">
                            <span class="custom-checkbox"></span>
                            <span class="checkbox-option-text">Leaks</span>
                        </label>
                        <label class="checkbox-option" onclick="toggleCheckbox(this, 'reason', 'Storm Damage')">
                            <input type="checkbox" name="reason[]" value="Storm Damage">
                            <span class="custom-checkbox"></span>
                            <span class="checkbox-option-text">Storm Damage</span>
                        </label>
                        <label class="checkbox-option" onclick="toggleCheckbox(this, 'reason', 'General Inspection')">
                            <input type="checkbox" name="reason[]" value="General Inspection">
                            <span class="custom-checkbox"></span>
                            <span class="checkbox-option-text">General Inspection</span>
                        </label>
                        <label class="checkbox-option" onclick="toggleCheckbox(this, 'reason', 'Other')">
                            <input type="checkbox" name="reason[]" value="Other" id="other-option">
                            <span class="custom-checkbox"></span>
                            <span class="checkbox-option-text">Other</span>
                        </label>
                    </div>
                    <p class="error-note" style="display: none;">Please select at least one option</p>
                    <div class="button-group">
                        <button type="button" class="back-btn" onclick="prevStep(2)">Back</button>
                        <button type="button" class="next-btn" onclick="nextStep(4)">Continue</button>
                    </div>
                </div>
                <!-- Step 4: Ok! What's your name? -->
                <div class="form-builder--item" data-step="4">
                    <div class="question-title">Ok! What's your name?</div>
                    <div class="input-group">
                        <input type="text" class="input-field" name="full_name" placeholder="Your full name" required>
                    </div>
                    <p class="error-note" style="display: none;">Please enter your full name</p>
                    <div class="button-group">
                        <button type="button" class="back-btn" onclick="prevStep(3)">Back</button>
                        <button type="button" class="next-btn" onclick="nextStep(5)">Continue</button>
                    </div>
                </div>
                <!-- Step 5: What's your email? -->
                <div class="form-builder--item" data-step="5">
                    <div class="question-title">What's your email?</div>
                    <div class="input-group">
                        <input type="email" class="input-field" name="email" placeholder="your.email@example.com" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" required>
                    </div>
                    <p class="error-note" style="display: none;">Please enter a valid email</p>
                    <div class="button-group">
                        <button type="button" class="back-btn" onclick="prevStep(4)">Back</button>
                        <button type="button" class="next-btn" onclick="nextStep(6)">Continue</button>
                    </div>
                </div>
                <!-- Step 6: What's your phone number? -->
                <div class="form-builder--item" data-step="6">
                    <div class="question-title">What's your phone number?</div>
                    <div class="input-group">
                        <input type="tel" class="input-field" name="phone" placeholder="(XXX) XXX-XXXX" required oninput="formatPhoneNumber(this)">
                    </div>
                    <div class="terms-and-conditions">
                        <input type="checkbox" id="terms" name="terms" checked required>
                        <label for="terms">By submitting, I agree to <a href="https://rocksolid.news/terms" target="_blank" rel="noopener noreferrer nofollow">terms & conditions</a> from Rock Solid Roofing and consent to receive texts.</label>
                    </div>
                    <p class="error-note" style="display: none;">Please fill all fields and agree to terms</p>
                    <div class="button-group">
                        <button type="button" class="back-btn" onclick="prevStep(5)">Back</button>
                        <button type="submit" class="submit-btn">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    @keyframes fadeSlideIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .quiz-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: #f5f5f5;
        z-index: 1000;
        overflow-y: auto;
        opacity: 0;
        transition: opacity 0.5s ease, transform 0.5s ease;
    }
    .quiz-overlay.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
        animation: fadeSlideIn 0.5s ease-out forwards;
    }
    .quiz-container {
        max-width: 750px;
        margin: 20px auto;
        padding: 20px;
        position: relative;
    }
    .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        font-size: 24px;
        color: #333;
        cursor: pointer;
        transition: color 0.3s ease;
    }
    .close-btn:hover {
        color: #ff0000;
    }
    .quiz-form {
        padding: 20px 0;
        background: transparent;
    }
    .form-builder--item {
        display: none;
        opacity: 0;
        transition: opacity 0.5s ease, transform 0.5s ease;
        transform: translateY(20px);
        margin-bottom: 30px;
        min-height: 300px;
    }
    .form-builder--item.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }
    .question-title {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 20px;
        color: #333;
    }
    .checkbox-options, .radio-options {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin: 20px 0;
    }
    .checkbox-option, .radio-option {
        background-color: #fff;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
    }
    .checkbox-option:hover, .radio-option:hover {
        border-color: #ff0000;
        box-shadow: 0 2px 8px rgba(255, 0, 0, 0.2);
    }
    .checkbox-option.selected, .radio-option.selected {
        background-color: rgba(255, 0, 0, 0.1);
        border-color: #ff0000;
    }
    .checkbox-option input, .radio-option input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }
    .checkbox-option-text, .radio-option-text {
        font-size: 18px;
        margin-left: 10px;
        color: #333;
    }
    .custom-checkbox, .custom-radio {
        width: 20px;
        height: 20px;
        background-color: #e0e0e0;
        border-radius: 50%;
        position: relative;
        display: inline-block;
    }
    .custom-checkbox {
        border-radius: 4px;
    }
    .checkbox-option.selected .custom-checkbox, .radio-option.selected .custom-radio {
        background-color: #ff0000;
    }
    .checkbox-option.selected .custom-checkbox:after {
        content: '✔';
        position: absolute;
        top: 2px;
        left: 4px;
        color: #fff;
        font-size: 14px;
    }
    .radio-option.selected .custom-radio:after {
        content: '';
        position: absolute;
        top: 6px;
        left: 6px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #fff;
    }
    .input-group {
        margin-bottom: 20px;
    }
    .input-field {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        background-color: #fff;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        color: #333;
        box-sizing: border-box;
        transition: all 0.3s ease;
    }
    .input-field:focus {
        border-color: #ff0000;
        outline: none;
        box-shadow: 0 0 8px rgba(255, 0, 0, 0.3);
    }
    .input-field::-moz-placeholder {
        color: #888;
    }
    .input-field::placeholder {
        color: #888;
    }
    .button-group {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        margin-top: 30px;
    }
    .next-btn, .submit-btn {
        flex: 1;
        background: linear-gradient(135deg, #ff3333, #ff0000);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Inter', sans-serif;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    .next-btn:hover, .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
    }
    .back-btn {
        flex: 1;
        background-color: #e0e0e0;
        color: #333;
        border: none;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Inter', sans-serif;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    .back-btn:hover {
        background-color: #d0d0d0;
    }
    .terms-and-conditions {
        display: flex;
        align-items: flex-start;
        margin: 20px 0;
    }
    .terms-and-conditions label {
        margin-left: 10px;
        font-size: 14px;
        color: #666;
    }
    .terms-and-conditions a {
        color: #ff0000;
        text-decoration: none;
    }
    .terms-and-conditions a:hover {
        text-decoration: underline;
    }
    .error-note {
        margin-top: 10px;
        color: #FF6B6B;
        font-size: 16px;
        display: none;
        align-items: center;
        gap: 8px;
    }
    @media (max-width: 768px) {
        .quiz-container {
            padding: 15px;
        }
        .question-title {
            font-size: 24px;
        }
        .checkbox-option-text, .radio-option-text {
            font-size: 16px;
        }
        .button-group {
            flex-direction: column;
        }
        .next-btn, .submit-btn {
            order: -1; /* Puts Continue/Submit above Back */
        }
        .back-btn {
            order: 0;
        }
    }
</style>

<script>
    (function() {
        let currentStep = 1;
        const totalSteps = 6;

        function closeOverlay() {
            const quizOverlay = document.getElementById('quiz-overlay');
            quizOverlay.style.transition = 'opacity 0.3s ease';
            quizOverlay.style.opacity = '0';
            setTimeout(() => {
                quizOverlay.classList.remove('active');
                quizOverlay.style.display = 'none';
                quizOverlay.style.opacity = '0';
                showStep(1);
            }, 300);
        }

        function showStep(step) {
            const steps = document.querySelectorAll(".form-builder--item");
            steps.forEach(item => {
                if (parseInt(item.getAttribute("data-step")) === step) {
                    item.classList.add("active");
                } else {
                    item.classList.remove("active");
                }
            });
            currentStep = step;
        }

        function selectOption(element, name, value, nextStep) {
            const options = document.querySelectorAll(`input[name="${name}"]`);
            options.forEach(option => {
                option.parentElement.classList.remove('selected');
            });
            element.classList.add('selected');
            const input = element.querySelector('input');
            input.checked = true;
            if (currentStep === 1 || currentStep === 2) {
                nextStepWithValidation(nextStep);
            }
        }

        function toggleCheckbox(element, name, value) {
            const otherOption = document.getElementById('other-option');
            const checkboxes = document.querySelectorAll(`input[name="${name}[]"]`);
            if (value === 'Other') {
                checkboxes.forEach(checkbox => {
                    if (checkbox.value !== 'Other') {
                        checkbox.checked = false;
                        checkbox.parentElement.classList.remove('selected');
                    }
                });
            } else if (otherOption && otherOption.checked) {
                otherOption.checked = false;
                otherOption.parentElement.classList.remove('selected');
            }
            const input = element.querySelector('input');
            input.checked = !input.checked;
            element.classList.toggle('selected', input.checked);
        }

        function formatPhoneNumber(input) {
            let numbers = input.value.replace(/\D/g, '');
            if (numbers.length > 10) {
                numbers = numbers.slice(0, 10);
            }
            let formatted = '';
            if (numbers.length > 0) {
                formatted = '(' + numbers.substring(0, 3);
                if (numbers.length >= 4) {
                    formatted += ') ' + numbers.substring(3, 6);
                }
                if (numbers.length >= 7) {
                    formatted += '-' + numbers.substring(6, 10);
                }
            }
            input.value = formatted;
        }

        function nextStepWithValidation(nextStep) {
            const currentStepElement = document.querySelector(`.form-builder--item[data-step="${currentStep}"]`);
            const inputs = currentStepElement.querySelectorAll("input[required]");
            let isValid = true;
            if (currentStep === 3) {
                const checked = currentStepElement.querySelectorAll(`input[name="reason[]"]:checked`).length;
                isValid = checked > 0;
            } else {
                inputs.forEach(input => {
                    if (input.type === "radio" && !currentStepElement.querySelector(`input[name="${input.name}"]:checked`)) {
                        isValid = false;
                    } else if (input.type === "checkbox" && !input.checked) {
                        isValid = false;
                    } else if (!input.value.trim()) {
                        isValid = false;
                    } else if (input.type === "email" && !/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i.test(input.value)) {
                        isValid = false;
                    }
                });
            }
            const errorNote = currentStepElement.querySelector(".error-note");
            if (isValid) {
                errorNote.style.display = "none";
                showStep(nextStep);
            } else {
                errorNote.style.display = "flex";
            }
        }

        function nextStep(nextStep) {
            nextStepWithValidation(nextStep);
        }

        function prevStep(prevStep) {
            const currentStepElement = document.querySelector(`.form-builder--item[data-step="${currentStep}"]`);
            currentStepElement.querySelector(".error-note").style.display = "none";
            showStep(prevStep);
        }

        // Handle form submission
        document.getElementById('_builder-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = 'Submitting...';
            submitBtn.disabled = true;

            try {
                // Collect form data
                const formData = new FormData(this);
                const data = {};
                
                // Handle checkbox arrays
                const reasons = formData.getAll('reason[]');
                if (reasons.length > 0) {
                    data.reason = reasons;
                }
                
                // Handle other fields
                for (let [key, value] of formData.entries()) {
                    if (key !== 'reason[]') {
                        data[key] = value;
                    }
                }

                // Get ZIP code from the landing page if available
                const zipCodeFromLanding = document.getElementById('zip-input');
                if (zipCodeFromLanding && zipCodeFromLanding.value) {
                    data.zip_code = zipCodeFromLanding.value;
                }

                const submissionData = {
                    projectId: window.projectId || 'unknown',
                    userId: window.userId || 'unknown',
                    name: data.full_name,
                    email: data.email,
                    phone: data.phone,
                    quizAnswers: data,
                    timestamp: new Date().toISOString()
                };

                console.log('Submitting quiz data:', submissionData);

                const response = await fetch('https://kcgdexuqztbdewmqmude.supabase.co/functions/v1/process-quiz-submission', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    console.log('Quiz submitted successfully:', result);
                    // Redirect to thank you page or show success message
                    window.location.href = 'https://www.google.com';
                } else {
                    throw new Error(result.error || 'Submission failed');
                }
            } catch (error) {
                console.error('Error submitting quiz:', error);
                alert('There was an error submitting your information. Please try again.');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        window.closeOverlay = closeOverlay;
        window.selectOption = selectOption;
        window.toggleCheckbox = toggleCheckbox;
        window.formatPhoneNumber = formatPhoneNumber;
        window.nextStep = nextStep;
        window.prevStep = prevStep;

        function initQuiz() {
            showStep(1);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initQuiz);
        } else {
            initQuiz();
        }
    })();
</script>

<script>
(function() {
  console.log('Quiz submission handler loaded for project:', '5e3ccce7-063b-4c4d-b49a-e0c0783619a9');
  
  // Function to submit quiz data
  async function submitQuizData(formData) {
    console.log('Submitting quiz data:', formData);
    
    try {
      const response = await fetch('https://kcgdexuqztbdewmqmude.supabase.co/functions/v1/process-quiz-submission', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjZ2RleHVxenRiZGV3bXFtdWRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3OTU0NjgsImV4cCI6MjA2MzM3MTQ2OH0.R-8DYALBi54jLURcYXI-q5YmfSs_Ui4QLxBscHK-yXY',
          'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjZ2RleHVxenRiZGV3bXFtdWRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3OTU0NjgsImV4cCI6MjA2MzM3MTQ2OH0.R-8DYALBi54jLURcYXI-q5YmfSs_Ui4QLxBscHK-yXY'
        },
        body: JSON.stringify({
          projectId: '5e3ccce7-063b-4c4d-b49a-e0c0783619a9',
          userId: '36b070d6-a5db-44fc-bb51-b5c4746f30fa',
          name: formData.name || formData.full_name || formData.firstName || '',
          email: formData.email || formData.email_address || '',
          phone: formData.phone || formData.phone_number || formData.phoneNumber || '',
          quizAnswers: formData,
          timestamp: new Date().toISOString()
        })
      });
      
      console.log('Response status:', response.status);
      const responseText = await response.text();
      console.log('Response text:', responseText);
      
      if (response.ok) {
        console.log('Quiz submission successful');
        showSuccessMessage();
      } else {
        console.error('Quiz submission failed:', responseText);
        showErrorMessage();
      }
      
    } catch (error) {
      console.error('Quiz submission error:', error);
      showErrorMessage();
    }
  }
  
  // Function to show success message
  function showSuccessMessage() {
    const successOverlay = document.createElement('div');
    successOverlay.id = 'quiz-success-overlay';
    successOverlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `;
    
    successOverlay.innerHTML = `
      <div style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 50px 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 450px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      ">
        <div style="
          position: absolute;
          top: -50%;
          left: -50%;
          width: 200%;
          height: 200%;
          background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
          animation: shimmer 3s ease-in-out infinite;
        "></div>
        <div style="
          width: 80px;
          height: 80px;
          background: linear-gradient(135deg, #4CAF50, #45a049);
          border-radius: 50%;
          margin: 0 auto 25px;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
          position: relative;
        ">
          <span style="color: white; font-size: 40px; font-weight: bold;">✓</span>
        </div>
        <h2 style="
          color: white; 
          margin-bottom: 20px; 
          font-size: 28px; 
          font-weight: 700;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        ">Thank You!</h2>
        <p style="
          color: rgba(255,255,255,0.9); 
          margin-bottom: 30px; 
          line-height: 1.6;
          font-size: 16px;
        ">
          We've received your information and will contact you shortly for your free consultation.
        </p>
        <button onclick="document.getElementById('quiz-success-overlay').remove()" style="
          background: linear-gradient(135deg, #fff, #f8f9fa);
          color: #333;
          border: none;
          padding: 15px 35px;
          border-radius: 30px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 600;
          box-shadow: 0 5px 15px rgba(0,0,0,0.2);
          transition: all 0.3s ease;
          transform: translateY(0);
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(0,0,0,0.2)'">
          Close
        </button>
      </div>
      <style>
        @keyframes shimmer {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    `;
    
    document.body.appendChild(successOverlay);
  }
  
  // Function to show error message
  function showErrorMessage() {
    const errorOverlay = document.createElement('div');
    errorOverlay.id = 'quiz-error-overlay';
    errorOverlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `;
    
    errorOverlay.innerHTML = `
      <div style="
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        padding: 50px 40px;
        border-radius: 20px;
        text-align: center;
        max-width: 450px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      ">
        <div style="
          width: 80px;
          height: 80px;
          background: rgba(255,255,255,0.2);
          border-radius: 50%;
          margin: 0 auto 25px;
          display: flex;
          align-items: center;
          justify-content: center;
        ">
          <span style="color: white; font-size: 40px; font-weight: bold;">✕</span>
        </div>
        <h2 style="
          color: white; 
          margin-bottom: 20px; 
          font-size: 28px; 
          font-weight: 700;
          text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        ">Oops!</h2>
        <p style="
          color: rgba(255,255,255,0.9); 
          margin-bottom: 30px; 
          line-height: 1.6;
          font-size: 16px;
        ">
          There was an error submitting your information. Please try again.
        </p>
        <button onclick="document.getElementById('quiz-error-overlay').remove()" style="
          background: linear-gradient(135deg, #fff, #f8f9fa);
          color: #333;
          border: none;
          padding: 15px 35px;
          border-radius: 30px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 600;
          box-shadow: 0 5px 15px rgba(0,0,0,0.2);
          transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          Try Again
        </button>
      </div>
    `;
    
    document.body.appendChild(errorOverlay);
  }
  
  // Handle quiz submission - ONLY for actual submit buttons in forms
  function handleQuizSubmission(event) {
    console.log('Form submission intercepted, event target:', event.target);
    
    // Only handle if it's actually a form submission or a submit button
    const isFormSubmission = event.type === 'submit' && event.target.tagName === 'FORM';
    const isSubmitButton = event.target.type === 'submit' || 
                          event.target.classList.contains('submit-btn') || 
                          event.target.classList.contains('quiz-submit') ||
                          (event.target.tagName === 'BUTTON' && event.target.textContent && event.target.textContent.toLowerCase().includes('submit'));
    
    console.log('Is form submission:', isFormSubmission, 'Is submit button:', isSubmitButton);
    
    if (!isFormSubmission && !isSubmitButton) {
      console.log('Not a quiz submission, ignoring');
      return;
    }
    
    // Skip if this is a privacy policy link, close button, or navigation element
    const target = event.target;
    const targetText = target.textContent?.toLowerCase() || '';
    const targetClass = target.className || '';
    const targetId = target.id || '';
    
    // List of elements that should NOT trigger quiz submission
    const skipElements = [
      'privacy', 'policy', 'terms', 'close', 'cancel', 'back', 'previous', 'next', 'continue',
      'x', '×', '✕', 'exit', 'dismiss', 'skip'
    ];
    
    const shouldSkip = skipElements.some(skip => 
      targetText.includes(skip) || 
      targetClass.includes(skip) || 
      targetId.includes(skip) ||
      target.getAttribute('aria-label')?.toLowerCase().includes(skip)
    );
    
    if (shouldSkip) {
      console.log('Skipping submission for navigation/control element:', targetText);
      return;
    }
    
    event.preventDefault();
    event.stopPropagation();
    console.log('Processing quiz submission');
    
    const form = event.target.closest('form') || document.querySelector('form');
    let data = {};
    
    if (form) {
      const formData = new FormData(form);
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }
    }
    
    // Collect data from radio buttons and checkboxes
    const radioButtons = document.querySelectorAll('input[type="radio"]:checked');
    radioButtons.forEach(radio => {
      data[radio.name] = radio.value;
    });
    
    const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
    checkboxes.forEach(checkbox => {
      if (!data[checkbox.name]) {
        data[checkbox.name] = [];
      }
      if (Array.isArray(data[checkbox.name])) {
        data[checkbox.name].push(checkbox.value);
      } else {
        data[checkbox.name] = [data[checkbox.name], checkbox.value];
      }
    });
    
    // Collect all input values as fallback
    const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="number"], textarea, select');
    inputs.forEach(input => {
      if (input.name && input.value) {
        data[input.name] = input.value;
      } else if (input.id && input.value) {
        data[input.id] = input.value;
      }
    });
    
    console.log('Collected form data:', data);
    
    // Ensure we have at least an email
    if (!data.email && !data.email_address) {
      showErrorMessage();
      return;
    }
    
    submitQuizData(data);
  }
  
  // Initialize quiz handler - be very specific about what we attach to
  function initializeQuizHandler() {
    console.log('Initializing quiz submission handler');
    
    // Remove any existing listeners first
    document.removeEventListener('submit', handleQuizSubmission, true);
    document.removeEventListener('click', handleQuizSubmission, true);
    
    // Only attach to form submit events
    document.addEventListener('submit', handleQuizSubmission, true);
    
    // Only attach click handler to actual submit buttons
    const submitButtons = document.querySelectorAll('button[type="submit"], input[type="submit"], .submit-btn, .quiz-submit');
    submitButtons.forEach(button => {
      // Skip if it's clearly a navigation or control button
      const buttonText = button.textContent?.toLowerCase() || '';
      const skipButtons = ['privacy', 'policy', 'terms', 'close', 'cancel', 'back', 'next', 'continue', 'x', '×', '✕'];
      
      if (skipButtons.some(skip => buttonText.includes(skip))) {
        console.log('Skipping button:', buttonText);
        return;
      }
      
      button.removeEventListener('click', handleQuizSubmission);
      button.addEventListener('click', handleQuizSubmission);
    });
    
    console.log('Quiz handler initialized for submit buttons only');
  }
  
  // Initialize multiple times to catch dynamic content
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeQuizHandler);
  } else {
    initializeQuizHandler();
  }
  
  setTimeout(initializeQuizHandler, 500);
  setTimeout(initializeQuizHandler, 1500);
  setTimeout(initializeQuizHandler, 3000);
})();
</script>
        <!-- END OF QUIZ -->

            <!-- END OF QUIZ -->

</body>